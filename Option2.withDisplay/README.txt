===============================================
           운동 프로그램 사용 설명서
===============================================

프로젝트 개요
-------------
웹캠(노트북 USB 직접 연결)과 아두이노를 통한 마이크/스피커 연결 환경에서 
음성 인식과 영상 분석을 통해 운동 동작을 안내하고 
실시간으로 자세를 판정하는 프로그램입니다.

하드웨어 구성
-------------
- 웹캠: 노트북에 USB 직접 연결
- 마이크: 노트북 내장 마이크 사용
- 스피커: 아두이노를 통해 연결  
- 아두이노: 노트북에 USB로 연결 (시리얼 통신)

주요 기능
---------
1. 음성 인식으로 "운동하자" 명령으로 프로그램 시작
2. 실시간 웹캠 영상에서 사람 인식 및 관절 노드 추출
3. 좌우 분할 화면: 실시간 웹캠 + 저장된 참조 영상
4. MediaPipe를 이용한 관절 각도 계산 및 자세 판정
5. 3초마다 자세 체크, 3회 실패 시 다음 동작으로 진행
6. 배경 음성 인식으로 "종료" 명령 감지
7. 운동 완료 후 종료 또는 재시작 선택

파일 구조
---------
├── main.py                    # 메인 프로그램 (프로그램 진입점)
├── SpeechRecognition.py       # 음성 인식 모듈 (노트북 내장 마이크 사용)
├── ExerciseMode.py            # 운동 모드 및 자세 판정
├── ReferenceVideo.py          # 참조 영상 재생 모듈
├── ArduinoCommunication.py    # 아두이노 시리얼 통신 모듈
├── ArduinoCode.ino            # 아두이노 코드 (스피커/LED 제어)
└── README.txt                # 이 파일 (사용 설명서)

필요한 라이브러리
----------------
- opencv-python (cv2)
- mediapipe
- speech_recognition
- numpy
- pyserial (아두이노 시리얼 통신용)
- threading (내장 모듈)
- time (내장 모듈)
- sys (내장 모듈)

설치 방법
---------
1. Python 3.7 이상 설치
2. 필요한 라이브러리 설치:
   pip install opencv-python mediapipe speech_recognition numpy pyserial

3. 하드웨어 연결 확인:
   - 웹캠: 노트북 USB 포트에 직접 연결
   - 아두이노: 노트북 USB 포트에 연결
   - 마이크: 노트북 내장 마이크 사용
   - 스피커: 아두이노에 연결

4. 아두이노 시리얼 포트 확인 (예: COM3, COM4 등)
5. 아두이노 코드 업로드 (아래 참조)
6. sample.mp4 파일을 프로젝트 폴더에 배치

아두이노 설정
-------------
아두이노에 다음 기능이 구현되어 있어야 합니다:
- 시리얼 통신 (9600 baud)
- LED 제어 (RGB LED 또는 여러 LED)
- 스피커/부저 제어 (음성 안내 및 효과음 재생)

아두이노 명령어 형식:
- LED:LED:on/off/green/red/blue/blink
- SOUND:SOUND:start/success/fail/complete/clap
- VOICE:VOICE:welcome/exercise_start/follow_me/success/fail/complete/goodbye

참고: 마이크는 노트북 내장 마이크를 사용하므로 아두이노에서 마이크 처리는 불필요합니다.

아두이노 코드 업로드
-------------------
1. ArduinoCode.ino 파일을 아두이노 IDE에서 열기
2. 하드웨어 연결 확인:
   - RGB LED: 핀 11(R), 10(G), 6(B)
   - 스피커/부저: 핀 9
3. 아두이노에 코드 업로드
4. 시리얼 모니터에서 "Arduino Ready" 메시지 확인

사용 방법
---------
1. 프로그램 실행:
   python main.py

2. "운동하자"라고 말하면 운동 시작
3. 카메라 앞에서 동작 따라하기
4. "종료"라고 말하면 언제든 중단 가능
5. 운동 완료 후 종료 또는 재시작 선택

프로그램 흐름
-------------
1. 대기 모드
   - "운동하자" 음성 인식 대기
   - 배경에서 "종료" 명령 감지

2. 실행 모드
   - 음성 안내: "안녕하세요! 함께 운동을 시작해볼까요?"
   - 카메라로 사람 인식
   - 관절 노드 좌표 추출

3. 동작 안내 및 판정
   - 만세하기 동작
     * 참조 영상 재생
     * 팔 각도 > 160도, 손목이 어깨보다 위쪽
     * 성공 시: "축하합니다! 박수! 👏"
     * 실패 시: 3회까지 재시도
   
   - 허리에 손 얹기 동작
     * 참조 영상 재생
     * 손목-허리 y좌표 차이 < 0.05
     * 성공 시: "축하합니다! 박수! 👏"
     * 실패 시: 3회까지 재시도

4. 완료 처리
   - "모든 운동이 끝났습니다. 수고하셨습니다."
   - 사용자 선택: 종료 또는 대기 모드로 복귀

화면 구성
---------
- 왼쪽: 실시간 웹캠 영상 + MediaPipe 관절 표시
- 오른쪽: 저장된 참조 영상 (sample.mp4)

음성 명령어
-----------
- "운동하자": 프로그램 시작
- "종료": 프로그램 중단 (언제든 가능)

자세 판정 기준
--------------
1. 만세하기 동작:
   - 팔 각도 > 160도 (어깨-팔꿈치-손목)
   - 손목이 어깨보다 위쪽 (y 좌표가 작음)

2. 허리에 손 얹기 동작:
   - 손목과 허리의 y 좌표 차이 < 0.05

오류 해결
---------
1. 카메라 인식 실패:
   - 웹캠이 제대로 연결되었는지 확인
   - 다른 프로그램에서 카메라를 사용 중인지 확인

2. 음성 인식 실패:
   - 노트북 내장 마이크가 활성화되어 있는지 확인
   - 마이크 권한이 허용되어 있는지 확인
   - 주변 소음이 적은 환경에서 사용
   - 인터넷 연결 확인 (Google API 사용)

3. 영상 파일 오류:
   - sample.mp4 파일이 프로젝트 폴더에 있는지 확인
   - 영상 파일이 손상되지 않았는지 확인

4. 라이브러리 오류:
   - pip install 명령으로 필요한 라이브러리 재설치
   - Python 버전 호환성 확인

5. 아두이노 연결 오류:
   - 아두이노가 올바른 포트에 연결되어 있는지 확인
   - 시리얼 포트 번호가 올바른지 확인 (COM3, COM4 등)
   - 아두이노 코드가 올바르게 업로드되었는지 확인
   - 시리얼 모니터에서 "Arduino Ready" 메시지 확인

개발자 정보
-----------
- 개발 환경: Python 3.x
- 주요 라이브러리: OpenCV, MediaPipe, SpeechRecognition
- 하드웨어 요구사항: 웹캠, 마이크, 스피커

버전 정보
---------
- 버전: 1.0
- 최종 수정일: 2024년
- 호환성: Windows 10/11, Python 3.7+

주의사항
---------
1. 웹캠이 제대로 연결되어 있어야 합니다
2. 노트북 내장 마이크가 활성화되어 있어야 합니다
3. 아두이노가 올바른 포트에 연결되어 있어야 합니다
4. 충분한 조명이 있는 환경에서 사용하세요
5. 카메라 앞에서 충분한 공간을 확보하세요
6. 음성 인식을 위해 조용한 환경에서 사용하세요
7. sample.mp4 파일이 반드시 프로젝트 폴더에 있어야 합니다

문의사항
---------
프로그램 사용 중 문제가 발생하면 다음을 확인해주세요:
1. 하드웨어 연결 상태
2. 라이브러리 설치 상태
3. 영상 파일 존재 여부
4. 인터넷 연결 상태

===============================================
                끝
===============================================
